<div id="post" class="mt-5 m-2">
  <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
  <div class="toolbar mb-2 flex justify-between items-center">
    <div class="flex space-x-2">
      <button type="button" class="px-4 py-2 rounded-md bg-gray-100 border border-gray-300 hover:bg-gray-200" id="bold-button">
        <strong>B</strong>
      </button>
    </div>
    <div class="text-sm text-gray-600" id="char-count">0 / 1000</div>
  </div>

  <!-- ãƒ•ã‚©ãƒ¼ãƒ  -->
  <%= form_with(model: @micropost, url: zen_create_path(slug: @user.slug), method: :post, local: true, html: { class: "micropost-form" }) do |f| %>
    <div class="field">
      <!-- ç·¨é›†ã‚¨ãƒªã‚¢ -->
      <div
        id="editor"
        contenteditable="true"
        class="p-4 rounded border shadow-md hover:shadow-lg transition-shadow duration-300 w-full h-[400px]"
        data-placeholder="I don't think anything is hard. It just takes time."
        style="min-height: 100px; overflow-y: auto;"
      ></div>
      
      <!-- éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ã‚¨ãƒ‡ã‚£ã‚¿ã®å†…å®¹ã‚’ä¿å­˜ï¼‰ -->
      <%= f.hidden_field :content, id: "hidden_content" %>
    </div>

    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <div class="actions text-right mt-2">
    <button
      class="px-4 py-2 bg-gray-200 text-gray-500 border border-gray-300 
             rounded-md cursor-not-allowed
             disabled:hover:bg-gray-200 disabled:opacity-50"
      disabled>
      ğŸ¤–AI
    </button>
  <% unless current_page?(camera_path) %>
    <button class="hover:bg-yellow-500 px-4 py-2 bg-gray-100 border border-gray-300 text-gray-700 
                   hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 
                   focus:ring-gray-300 rounded-md">
      <%= link_to "ğŸ“¸ æ‰‹æ›¸ãã‚’èª­ã¿å–ã‚‹", camera_path(@user), class: "submit-button text-dark text-decoration-none" %>
    </button>
  <% end %>


    <%= f.submit "ğŸ“ ä¸‹æ›¸ãä¿å­˜", name: "draft", class: "hover:bg-yellow-500 px-4 py-2 bg-gray-200 border border-gray-300 text-gray-800 
               hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 
               focus:ring-gray-400 rounded-md" %>

    <%= f.submit "post", class: "hover:bg-yellow-500 px-4 py-2 bg-gray-200 border border-gray-300 text-gray-800 
               hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 
               focus:ring-gray-400 rounded-md" %>
  </div>

  <% end %>
</div>

<!-- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”¨CSS -->
<style>
  [data-placeholder]:empty::before {
    content: attr(data-placeholder);
    color: #aaa;
    pointer-events: none;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const boldButton = document.getElementById('bold-button');
    const editor = document.getElementById('editor');
    const hiddenContent = document.getElementById('hidden_content');
    const charCount = document.getElementById('char-count');
    const MAX_CHARS = 1000;

    // ç·¨é›†ã‚¨ãƒªã‚¢ã®å†…å®¹ã‚’éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åŒæœŸ
    function syncContent() {
      hiddenContent.value = editor.innerHTML;
    }

    // æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦è¡¨ç¤º
    function updateCharCount() {
      const text = editor.innerText || ""; // ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’å–å¾—
      const currentCount = text.length;
      
      charCount.textContent = `${currentCount} / ${MAX_CHARS}`;
      if (currentCount > MAX_CHARS) {
        charCount.classList.add('text-red-500');
        editor.innerText = text.substring(0, MAX_CHARS); // è¶…éåˆ†ã‚’ã‚«ãƒƒãƒˆ
      } else {
        charCount.classList.remove('text-red-500');
      }
    }

    // å¤ªå­—ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    boldButton.addEventListener('click', function (event) {
      event.preventDefault();
      document.execCommand('bold'); // å¤ªå­—ã‚’é©ç”¨
      syncContent(); // éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°
      updateCharCount(); // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
    });

    // ç·¨é›†ã‚¨ãƒªã‚¢ã®å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ
    editor.addEventListener('input', function () {
      syncContent();
      updateCharCount();
    });

    // åˆæœŸæ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
    updateCharCount();
  });
</script>
